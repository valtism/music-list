var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,o=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,l=(e,t)=>{for(var r in t||(t={}))a.call(t,r)&&o(e,r,t[r]);if(n)for(var r of n(t))s.call(t,r)&&o(e,r,t[r]);return e},i=(e,n)=>t(e,r(n)),c=(e,t)=>{var r={};for(var o in e)a.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&n)for(var o of n(e))t.indexOf(o)<0&&s.call(e,o)&&(r[o]=e[o]);return r};import{r as u,l as m,R as d,c as p,a as f,u as g,b as h,T as v,M as w,D as b,d as x,S as y,e as E,f as N,g as D,s as k,K as A,h as S,C,t as O,i as j}from"./vendor.9e876605.js";async function L(){const e=await fetch("https://1pd7ps5dmd.execute-api.ap-southeast-2.amazonaws.com/default/spotifyAuth"),{access_token:t,token_type:r,expires_in:n}=await e.json();return{token:`${r} ${t}`,expiresAt:Date.now()+1e3*(n-100)}}async function I(e,t){if(!t)return[];e.token||(e=await L());const r=await fetch(`https://api.spotify.com/v1/search?type=album&limit=5&q=${t}`,{headers:{Authorization:e.token}}),{albums:n}=await r.json();return n.items}const R={input:"",index:0,albums:[],searches:{}};function z(e,t){switch(t.type){case"setInput":return i(l({},e),{input:t.payload,index:0,albums:e.searches[t.payload]||e.albums});case"setAlbums":return i(l({},e),{albums:e.searches[e.input]?e.searches[e.input]:t.payload.albums,searches:i(l({},e.searches),{[t.payload.query]:t.payload.albums})});case"arrowUp":{const{index:t,albums:r}=e;return i(l({},e),{index:t<=0?r.length-1:t-1})}case"arrowDown":{const{index:t,albums:r}=e;return i(l({},e),{index:t>=r.length-1?0:t+1})}case"blur":return i(l({},e),{albums:[]});case"reset":return i(l({},e),{input:"",albums:[]});default:throw new Error}}function M(e){return u.exports.createElement("svg",l({viewBox:"0 0 16 16"},e),u.exports.createElement("path",{d:"M4.99 13v-3H15V3h-2v5H4.99V5L1 9l3.99 4z"}))}function H(e){return u.exports.createElement("svg",l({viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},e),u.exports.createElement("path",{fillRule:"evenodd",d:"M9.476 10.89a6 6 0 111.414-1.414l4.845 4.845-1.414 1.414-4.845-4.844zM9.818 6a3.818 3.818 0 11-7.636 0 3.818 3.818 0 017.636 0z"}))}function P({auth:e,onAlbumSelect:t}){const[r,n]=u.exports.useReducer(z,R),{input:a,index:s,albums:o,searches:l}=r,i=u.exports.useMemo((()=>m((async t=>{const r=await I(e,t);n({type:"setAlbums",payload:{albums:r,query:t}})}),300)),[e,n]),c=u.exports.useRef(null),f=function(e,...t){const r=u.exports.useRef(null);return u.exports.useEffect((()=>{const n=n=>{r.current&&![r,...t].some((e=>{var t;return null==(t=e.current)?void 0:t.contains(n.target)}))&&e(n)};return document.addEventListener("mousedown",n),document.addEventListener("mouseup",n),document.addEventListener("touchstart",n),document.addEventListener("touchend",n),()=>{document.removeEventListener("mousedown",n),document.removeEventListener("mouseup",n),document.removeEventListener("touchstart",n),document.removeEventListener("touchend",n)}}),[r,e,t]),r}((()=>n({type:"blur"})),c);return d.createElement("div",{className:"w-96 max-w-[calc(100%-16px)]",onKeyDown:e=>{switch(e.key){case"ArrowUp":return e.preventDefault(),n({type:"arrowUp"});case"ArrowDown":return e.preventDefault(),n({type:"arrowDown"});case"Enter":if(e.preventDefault(),!o[s])return;return t(o[s]),i.cancel(),n({type:"reset"});case"Escape":return e.preventDefault(),i.cancel(),n({type:"reset"})}}},d.createElement("div",{className:"relative group"},d.createElement("input",{ref:c,autoCorrect:"off",placeholder:"Search",value:a,onChange:e=>{const t=e.target.value;l[t]?i.cancel():i(t),n({type:"setInput",payload:t})},onFocus:async t=>{if(t.target.select(),a)if(l[a])n({type:"setAlbums",payload:{albums:l[a],query:a}});else{const t=await I(e,a);n({type:"setAlbums",payload:{albums:t,query:a}})}},className:p("w-full border-2 border-gray-100 bg-gray-100 rounded-lg px-4 py-2","hover:border-purple-100","focus:bg-white focus:border-purple-100 focus:outline-none",o.length&&"rounded-b-none bg-white border-purple-100 outline-none")}),d.createElement("div",{className:"absolute inset-y-0 right-0 flex items-center pr-4 pointer-events-none"},d.createElement(H,{className:p("w-4 h-4 fill-current text-gray-400","group-hover:text-purple-500 group-hover:text-opacity-80","group-focus-within:text-purple-500 group-focus-within:text-opacity-80")}))),!!o.length&&d.createElement("ul",{ref:f,className:"absolute z-10 w-96 max-w-[calc(100%-16px)] bg-white shadow-xl overflow-auto rounded-b-lg border-2 border-t-0 border-purple-100 divide-y-2 divide-purple-100"},o.map(((e,r)=>d.createElement(q,{key:e.id,album:e,isHighlighted:r===s,onClick:()=>{t(e),n({type:"reset"})}})))))}function q(e){var t=e,{album:r,isHighlighted:n}=t,a=c(t,["album","isHighlighted"]);return d.createElement("li",{key:r.id},d.createElement("button",l({className:p("group relative w-full flex items-center justify-between px-2 py-1.5 hover:bg-purple-100 overflow-hidden","focus:outline-none",n&&"bg-purple-100")},a),d.createElement("div",{className:"relative w-full flex items-center space-x-2 overflow-hidden"},d.createElement("img",{src:r.images[2].url,className:"w-10 h-10 rounded"}),d.createElement("div",{className:"flex flex-col items-start leading-5"},d.createElement("div",{title:r.name,className:"whitespace-nowrap"},r.name),d.createElement("div",{title:r.artists[0].name,className:"whitespace-nowrap text-gray-900 text-opacity-60"},r.artists[0].name)),d.createElement("div",{className:"absolute h-full w-4 right-0 bg-gradient-to-l from-white group-hover:from-purple-100"})),n&&d.createElement("div",{className:"absolute right-0 h-full flex items-center pointer-events-none"},d.createElement("div",{className:"w-10 h-full bg-gradient-to-l from-purple-100"}),d.createElement("div",{className:"h-full bg-purple-100 flex items-center px-4"},d.createElement(M,{className:"w-4 h-4 fill-current text-purple-600 text-opacity-60 flex-shrink-0"})))))}function B(e){return u.exports.createElement("svg",l({viewBox:"0 0 16 16"},e),u.exports.createElement("path",{d:"M11.536 12.95L8 9.414 4.465 12.95 3.05 11.536 6.586 8 3.05 4.465 4.465 3.05 8 6.586l3.536-3.536 1.414 1.415L9.414 8l3.536 3.536-1.414 1.414z"}))}function T({album:e,onCloseClick:t,className:r}){return d.createElement("div",{className:p("group overflow-hidden",r)},d.createElement("div",{className:"relative flex flex-col"},t&&d.createElement(U,{onClick:e=>{e.stopPropagation(),t()}}),d.createElement("img",{src:e.images[0].url,onDragStart:e=>e.preventDefault(),className:"self-center"})))}function U(e){var t=c(e,[]);return d.createElement("button",l({className:"invisible group-hover:visible absolute top-0 right-0 p-2 bg-black bg-opacity-30 rounded-bl-lg text-gray-200 hover:text-white focus:outline-none"},t),d.createElement(B,{className:"w-4 h-4 fill-current"}))}const $=f((e=>({ids:Array(9).fill(null).map(((e,t)=>t.toString())),entities:Object.fromEntries(Array(9).fill(null).map(((e,t)=>[t.toString(),null]))),add:t=>e((e=>{const r=e.ids.find((t=>null===e.entities[t]));return void 0===r?e:i(l({},e),{entities:i(l({},e.entities),{[r]:t})})})),sort:(t,r)=>e((e=>{const n=e.ids.findIndex((e=>e===t)),a=e.ids.findIndex((e=>e===r)),s=e.ids.slice();return s[n]=r,s[a]=t,i(l({},e),{ids:s})})),remove:t=>e((e=>i(l({},e),{entities:i(l({},e.entities),{[t]:null})})))})));function _({items:e,onDragEnd:t,children:r}){const[n,a]=u.exports.useState(null),s=g(h(w,{activationConstraint:{distance:15}}),h(v,{activationConstraint:{distance:15}}),h(A,{coordinateGetter:k})),o=$((e=>e.entities[n||""]));return d.createElement(b,{sensors:s,collisionDetection:x,onDragStart:e=>a(e.active.id),onDragEnd:e=>{t(e),a(null)},onDragCancel:()=>a(null)},d.createElement(y,{items:e,strategy:E},r),N.exports.createPortal(d.createElement(D,{adjustScale:!0,zIndex:2},o&&d.createElement(T,{album:o,className:"shadow-xl ring-4 ring-purple-400"})),document.body))}function F(e){var t=e,{id:r,dragClassNames:n,children:a}=t,s=c(t,["id","dragClassNames","children"]);const{attributes:o,listeners:u,setNodeRef:m,transform:f,transition:g,isDragging:h}=S({id:r,animateLayoutChanges:()=>!1}),v={transform:C.Transform.toString(f),transition:g||void 0};return d.createElement("li",i(l(l(i(l({},s),{ref:m,style:v}),o),u),{className:p(s.className,h&&n)}),a)}function J(){const[e,t]=function(e,t){const[r,n]=u.exports.useState((()=>{try{const r=window.localStorage.getItem(e);if(!r)return t;try{return JSON.parse(r)}catch{return t}}catch(r){return console.error(r),t}}));return[r,t=>{try{const a=t instanceof Function?t(r):t;n(a),window.localStorage.setItem(e,JSON.stringify(a))}catch(a){console.log(a)}}]}("auth",{token:"",expiresAt:Date.now()});return u.exports.useEffect((()=>{e.token&&e.expiresAt>Date.now()||async function e(){const r=await L();t(r),setTimeout(e,r.expiresAt-Date.now())}()}),[e.expiresAt,e.token,t]),e}function K(){const e=J(),t=$((e=>e.ids)),r=$((e=>e.entities)),n=$((e=>e.add)),a=$((e=>e.sort)),s=$((e=>e.remove)),o=u.exports.useRef(null);return d.createElement("div",{className:"font-nunito flex flex-col space-y-10 items-center pt-10 text-gray-900"},d.createElement("h1",{className:"font-work text-5xl bg-gradient-to-r from-pink-400 via-purple-500 to-pink-400 bg-clip-text text-transparent animate-stripes motion-reduce:animate-none filter drop-shadow-lg"},"Music List"),d.createElement(P,{auth:e,onAlbumSelect:e=>n(e)}),d.createElement("div",null,d.createElement("div",{ref:o,className:"bg-white"},d.createElement(_,{items:t,onDragEnd:({active:e,over:t})=>{t&&e.id!==t.id&&a(e.id,t.id)}},d.createElement("ul",{style:{lineHeight:0,width:"90vw",height:"90vw",maxWidth:576,maxHeight:576}},t.map((e=>{const t=r[e];return d.createElement(F,{key:e,id:e,className:"inline-flex w-1/3 h-1/3 overflow-hidden cursor-default focus:outline-none focus:ring-4 focus:relative ring-purple-300",dragClassNames:"opacity-30 focus:ring-0"},t?d.createElement(T,{album:t,onCloseClick:()=>s(e)}):d.createElement("div",{className:"flex flex-1 bg-gray-200 bg-opacity-90"}))})))))),d.createElement(V,{exportRef:o}))}function V({exportRef:e}){return d.createElement("button",{onClick:async()=>{if(!e.current)return;!function(e,t){const r=document.createElement("a");r.href=e,r.setAttribute("download",t),r.click()}(await O(e.current),"chart.jpg")}},"Download")}j.render(d.createElement(d.StrictMode,null,d.createElement(K,null)),document.getElementById("root"));
