var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,o=(t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r,s=(e,t)=>{for(var n in t||(t={}))a.call(t,n)&&o(e,n,t[n]);if(r)for(var n of r(t))l.call(t,n)&&o(e,n,t[n]);return e},i=(e,r)=>t(e,n(r)),c=(e,t)=>{var n={};for(var o in e)a.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&r)for(var o of r(e))t.indexOf(o)<0&&l.call(e,o)&&(n[o]=e[o]);return n};import{r as u,a as m,u as d,b as p,c as f,l as g,R as h,d as v,s as x,e as w,f as E,T as b,M as y,D as N,g as k,S as D,h as C,i as S,j as A,k as j,K as O,m as L,C as F,t as M,n as z}from"./vendor.90e0e9f8.js";async function H(){const e=await fetch("https://1pd7ps5dmd.execute-api.ap-southeast-2.amazonaws.com/default/spotifyAuth"),{access_token:t,token_type:n,expires_in:r}=await e.json();return{token:`${n} ${t}`,expiresAt:Date.now()+1e3*(r-100)}}async function R(e,t){if(!t)return[];e.token||(e=await H());const n=await fetch(`https://api.spotify.com/v1/search?type=album&limit=5&q=${t}`,{headers:{Authorization:e.token}}),{albums:r}=await n.json();return r.items}const I=m(""),P=m(0),B=m([]),q=m({}),T=m(null,((e,t,n)=>{t(I,n),t(P,0);const r=e(q);r[n]&&t(B,r[n])})),K=m(null,((e,t,{albums:n,query:r})=>{const a=e(q),l=e(I);t(B,a[l]||n),t(q,i(s({},a),{[r]:n}))})),$=m(null,((e,t)=>{t(I,""),t(B,[])}));function _(e){return u.exports.createElement("svg",s({viewBox:"0 0 16 16"},e),u.exports.createElement("path",{d:"M4.99 13v-3H15V3h-2v5H4.99V5L1 9l3.99 4z"}))}function J(e){return u.exports.createElement("svg",s({viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},e),u.exports.createElement("path",{fillRule:"evenodd",d:"M9.476 10.89a6 6 0 111.414-1.414l4.845 4.845-1.414 1.414-4.845-4.844zM9.818 6a3.818 3.818 0 11-7.636 0 3.818 3.818 0 017.636 0z"}))}function V({auth:e,onAlbumSelect:t}){const n=d(I),[r,a]=p(P),[l,o]=p(B),s=d(q),i=f(T),c=f(K),m=f($),x=u.exports.useMemo((()=>g((async t=>{const n=await R(e,t);c({albums:n,query:t})}),300)),[e,c]),w=u.exports.useRef(null),E=function(e,...t){const n=u.exports.useRef(null);return u.exports.useEffect((()=>{const r=r=>{n.current&&![n,...t].some((e=>{var t;return null==(t=e.current)?void 0:t.contains(r.target)}))&&e(r)};return document.addEventListener("mousedown",r),document.addEventListener("mouseup",r),document.addEventListener("touchstart",r),document.addEventListener("touchend",r),()=>{document.removeEventListener("mousedown",r),document.removeEventListener("mouseup",r),document.removeEventListener("touchstart",r),document.removeEventListener("touchend",r)}}),[n,e,t]),n}((()=>o([])),w),b=r<=0?l.length-1:r-1,y=r>=l.length-1?0:r+1;return h.createElement("div",{className:"w-full max-w-sm",onKeyDown:e=>{switch(e.key){case"ArrowUp":e.preventDefault(),a(b);break;case"ArrowDown":e.preventDefault(),a(y);break;case"Tab":e.preventDefault(),a(e.shiftKey?b:y);break;case"Enter":if(e.preventDefault(),!l[r])return;t(l[r]),m();break;case"Escape":e.preventDefault(),m()}}},h.createElement("div",{className:"relative group"},h.createElement("input",{ref:w,autoCorrect:"off",placeholder:"Search",value:n,onChange:e=>{const t=e.target.value;s[t]||x(t),i(t)},onFocus:async t=>{if(t.target.select(),n)if(s[n])c({albums:s[n],query:n});else{const t=await R(e,n);c({albums:t,query:n})}},className:v("w-full border-2 border-gray-100 bg-gray-100 rounded-lg px-4 py-2 text-gray-900/90","hover:border-purple-100","focus:bg-white focus:border-purple-100 focus:outline-none caret-purple-600/90",l.length&&"rounded-b-none bg-white border-purple-100 outline-none")}),h.createElement("div",{className:"absolute inset-y-0 right-0 flex items-center pr-4 pointer-events-none"},h.createElement(J,{className:v("w-4 h-4 fill-current text-gray-400","group-hover:text-purple-500/80 group-focus-within:text-purple-500/80")}))),!!l.length&&h.createElement("ul",{ref:E,className:"absolute z-10 w-[calc(100%-32px)] max-w-sm bg-white shadow-xl overflow-auto rounded-b-lg border-2 border-t-0 border-purple-100 divide-y-2 divide-purple-100"},l.map(((e,n)=>h.createElement(W,{key:e.id,album:e,isHighlighted:n===r,onClick:()=>{t(e),m()}})))))}function W(e){var t=e,{album:n,isHighlighted:r}=t,a=c(t,["album","isHighlighted"]);return h.createElement("li",{key:n.id},h.createElement("button",s({className:v("group relative w-full flex items-center justify-between px-2 py-1.5","hover:bg-purple-100 overflow-hidden focus:outline-none",r&&"bg-purple-100")},a),h.createElement("div",{className:"relative w-full flex items-center space-x-2 overflow-hidden"},h.createElement("img",{src:n.images[2].url,className:"w-10 h-10 rounded"}),h.createElement("div",{className:"flex flex-col items-start leading-5"},h.createElement("div",{title:n.name,className:"whitespace-nowrap"},n.name),h.createElement("div",{title:n.artists[0].name,className:"whitespace-nowrap text-gray-900/60"},n.artists[0].name)),!r&&h.createElement("div",{className:"absolute h-full w-4 right-0 bg-gradient-to-l from-white group-hover:from-purple-100"})),r&&h.createElement("div",{className:"hidden md:flex absolute right-0 h-full items-center pointer-events-none"},h.createElement("div",{className:"w-10 h-full bg-gradient-to-l from-purple-100"}),h.createElement("div",{className:"h-full bg-purple-100 flex items-center px-4"},h.createElement(_,{className:"w-4 h-4 fill-current text-purple-600/60 flex-shrink-0"})))))}function G(e){return u.exports.createElement("svg",s({viewBox:"0 0 16 16"},e),u.exports.createElement("path",{d:"M11.536 12.95L8 9.414 4.465 12.95 3.05 11.536 6.586 8 3.05 4.465 4.465 3.05 8 6.586l3.536-3.536 1.414 1.415L9.414 8l3.536 3.536-1.414 1.414z"}))}function U({album:e,onCloseClick:t,className:n}){return h.createElement("div",{className:v("group overflow-hidden",n)},h.createElement("div",{className:"relative flex flex-col"},t&&h.createElement(Q,{onClick:e=>{e.stopPropagation(),t()}}),h.createElement("img",{src:e.images[0].url,onDragStart:e=>e.preventDefault(),className:"self-center"})))}function Q(e){var t=c(e,[]);return h.createElement("button",s({className:"invisible group-hover:visible absolute top-0 right-0 p-2 bg-black/30 rounded-bl-lg text-gray-200 hover:text-white focus:outline-none"},t),h.createElement(G,{className:"w-4 h-4 fill-current"}))}const X=m(Array(9).fill(null).map(((e,t)=>t.toString()))),Y=m(Object.fromEntries(Array(9).fill(null).map(((e,t)=>[t.toString(),null])))),Z=m(null,((e,t,n)=>{const r=e(X),a=e(Y),l=r.find((e=>null===a[e]));void 0!==l&&t(Y,i(s({},a),{[l]:n}))})),ee=m(null,((e,t,{from:n,to:r})=>{const a=e(X),l=a.findIndex((e=>e===n)),o=a.findIndex((e=>e===r)),s=a.slice();s[l]=r,s[o]=n,t(X,s)})),te=m(null,((e,t,n)=>{t(Y,i(s({},e(Y)),{[n]:null}))}));function ne(e){return d(u.exports.useMemo((()=>x(Y,(t=>t[e||""]))),[e]))}function re({items:e,onDragEnd:t,children:n}){const[r,a]=u.exports.useState(null),l=w(E(y,{activationConstraint:{distance:15}}),E(b,{activationConstraint:{distance:15}}),E(O,{coordinateGetter:j})),o=ne(r);return h.createElement(N,{sensors:l,collisionDetection:k,onDragStart:e=>a(e.active.id),onDragEnd:e=>{t(e),a(null)},onDragCancel:()=>a(null)},h.createElement(D,{items:e,strategy:C},n),S.exports.createPortal(h.createElement(A,{adjustScale:!0,zIndex:2},o&&h.createElement(U,{album:o,className:"shadow-xl ring-4 ring-purple-400"})),document.body))}function ae(e){var t=e,{id:n,dragClassNames:r,children:a}=t,l=c(t,["id","dragClassNames","children"]);const{attributes:o,listeners:u,setNodeRef:m,transform:d,transition:p,isDragging:f}=L({id:n,animateLayoutChanges:()=>!1}),g={transform:F.Transform.toString(d),transition:p||void 0};return h.createElement("li",i(s(s(i(s({},l),{ref:m,style:s({touchAction:"none"},g)}),o),u),{className:v(l.className,f&&r)}),a)}function le({exportRef:e}){return h.createElement("button",{onClick:async()=>{if(!e.current)return;!function(e,t){const n=document.createElement("a");n.href=e,n.setAttribute("download",t),n.click()}(await M(e.current,{canvasHeight:1920,canvasWidth:1920}),"chart.jpg")},style:{background:"repeating-linear-gradient(\n          -55deg,\n          #FCE7F3,\n          #FCE7F3 10px,\n          #FBCFE8 10px,\n          #FBCFE8 20px\n        )"},className:"px-2 py-1 rounded font-work text-purple-900/80 text-lg hover:shadow-md active:shadow-inner focus:outline-none focus:ring ring-purple-400"},"Download")}function oe(){const[e,t]=function(e,t){const[n,r]=u.exports.useState((()=>{try{const n=window.localStorage.getItem(e);if(!n)return t;try{return JSON.parse(n)}catch{return t}}catch(n){return console.error(n),t}}));return[n,t=>{try{const a=t instanceof Function?t(n):t;r(a),window.localStorage.setItem(e,JSON.stringify(a))}catch(a){console.log(a)}}]}("auth",{token:"",expiresAt:Date.now()});return u.exports.useEffect((()=>{e.token&&e.expiresAt>Date.now()||async function e(){const n=await H();t(n),setTimeout(e,n.expiresAt-Date.now())}()}),[e.expiresAt,e.token,t]),e}function se(){const e=oe(),t=d(X),n=f(Z),r=f(ee),a=u.exports.useRef(null);return h.createElement("div",{className:"font-nunito flex flex-col space-y-10 items-center px-4 py-10 text-gray-900"},h.createElement("h1",{className:"font-work text-5xl bg-gradient-to-r from-pink-400 via-purple-500 to-pink-400 bg-clip-text text-transparent animate-stripes motion-reduce:animate-none filter drop-shadow-lg"},"Music List"),h.createElement(V,{auth:e,onAlbumSelect:e=>n(e)}),h.createElement("div",null,h.createElement("div",{ref:a,className:"bg-white"},h.createElement(re,{items:t,onDragEnd:({active:e,over:t})=>{t&&e.id!==t.id&&r({from:e.id,to:t.id})}},h.createElement("ul",{style:{lineHeight:0,width:"90vw",height:"90vw",maxWidth:576,maxHeight:576}},t.map((e=>h.createElement(ie,{key:e,id:e}))))))),h.createElement(le,{exportRef:a}))}function ie({id:e}){const t=ne(e),n=f(te);return h.createElement(ae,{key:e,id:e,className:"inline-flex w-1/3 h-1/3 overflow-hidden cursor-default focus:outline-none focus:ring-4 focus:relative ring-purple-300",dragClassNames:"opacity-30 focus:ring-0"},t?h.createElement(U,{album:t,onCloseClick:()=>n(e)}):h.createElement("div",{className:"flex flex-1 bg-gray-200"}))}z.render(h.createElement(h.StrictMode,null,h.createElement(se,null)),document.getElementById("root"));
