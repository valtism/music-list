var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,o=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,l=(e,t)=>{for(var r in t||(t={}))a.call(t,r)&&o(e,r,t[r]);if(n)for(var r of n(t))s.call(t,r)&&o(e,r,t[r]);return e},i=(e,n)=>t(e,r(n)),c=(e,t)=>{var r={};for(var o in e)a.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&n)for(var o of n(e))t.indexOf(o)<0&&s.call(e,o)&&(r[o]=e[o]);return r};import{r as u,l as m,R as p,c as d,a as f,u as g,b as h,T as v,M as x,D as b,d as w,S as y,e as E,f as N,g as k,s as D,K as C,h as A,C as S,t as O,i as j}from"./vendor.956c3309.js";async function L(){const e=await fetch("https://1pd7ps5dmd.execute-api.ap-southeast-2.amazonaws.com/default/spotifyAuth"),{access_token:t,token_type:r,expires_in:n}=await e.json();return{token:`${r} ${t}`,expiresAt:Date.now()+1e3*(n-100)}}async function F(e,t){if(!t)return[];e.token||(e=await L());const r=await fetch(`https://api.spotify.com/v1/search?type=album&limit=5&q=${t}`,{headers:{Authorization:e.token}}),{albums:n}=await r.json();return n.items}const I={input:"",index:0,albums:[],searches:{}};function R(e,t){switch(t.type){case"setInput":return i(l({},e),{input:t.payload,index:0,albums:e.searches[t.payload]||e.albums});case"setAlbums":return i(l({},e),{albums:e.searches[e.input]?e.searches[e.input]:t.payload.albums,searches:i(l({},e.searches),{[t.payload.query]:t.payload.albums})});case"arrowUp":{const{index:t,albums:r}=e;return i(l({},e),{index:t<=0?r.length-1:t-1})}case"arrowDown":{const{index:t,albums:r}=e;return i(l({},e),{index:t>=r.length-1?0:t+1})}case"blur":return i(l({},e),{albums:[]});case"reset":return i(l({},e),{input:"",albums:[]});default:throw new Error}}function z(e){return u.exports.createElement("svg",l({viewBox:"0 0 16 16"},e),u.exports.createElement("path",{d:"M4.99 13v-3H15V3h-2v5H4.99V5L1 9l3.99 4z"}))}function H(e){return u.exports.createElement("svg",l({viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},e),u.exports.createElement("path",{fillRule:"evenodd",d:"M9.476 10.89a6 6 0 111.414-1.414l4.845 4.845-1.414 1.414-4.845-4.844zM9.818 6a3.818 3.818 0 11-7.636 0 3.818 3.818 0 017.636 0z"}))}function M({auth:e,onAlbumSelect:t}){const[r,n]=u.exports.useReducer(R,I),{input:a,index:s,albums:o,searches:l}=r,i=u.exports.useMemo((()=>m((async t=>{const r=await F(e,t);n({type:"setAlbums",payload:{albums:r,query:t}})}),300)),[e,n]),c=u.exports.useRef(null),f=function(e,...t){const r=u.exports.useRef(null);return u.exports.useEffect((()=>{const n=n=>{r.current&&![r,...t].some((e=>{var t;return null==(t=e.current)?void 0:t.contains(n.target)}))&&e(n)};return document.addEventListener("mousedown",n),document.addEventListener("mouseup",n),document.addEventListener("touchstart",n),document.addEventListener("touchend",n),()=>{document.removeEventListener("mousedown",n),document.removeEventListener("mouseup",n),document.removeEventListener("touchstart",n),document.removeEventListener("touchend",n)}}),[r,e,t]),r}((()=>n({type:"blur"})),c);return p.createElement("div",{className:"w-96 max-w-[calc(100%-16px)]",onKeyDown:e=>{switch(e.key){case"ArrowUp":return e.preventDefault(),n({type:"arrowUp"});case"ArrowDown":return e.preventDefault(),n({type:"arrowDown"});case"Enter":if(e.preventDefault(),!o[s])return;return t(o[s]),i.cancel(),n({type:"reset"});case"Escape":return e.preventDefault(),i.cancel(),n({type:"reset"})}}},p.createElement("div",{className:"relative group"},p.createElement("input",{ref:c,autoCorrect:"off",placeholder:"Search",value:a,onChange:e=>{const t=e.target.value;l[t]?i.cancel():i(t),n({type:"setInput",payload:t})},onFocus:async t=>{if(t.target.select(),a)if(l[a])n({type:"setAlbums",payload:{albums:l[a],query:a}});else{const t=await F(e,a);n({type:"setAlbums",payload:{albums:t,query:a}})}},className:d("w-full border-2 border-gray-100 bg-gray-100 rounded-lg px-4 py-2","hover:border-purple-100","focus:bg-white focus:border-purple-100 focus:outline-none",o.length&&"rounded-b-none bg-white border-purple-100 outline-none")}),p.createElement("div",{className:"absolute inset-y-0 right-0 flex items-center pr-4 pointer-events-none"},p.createElement(H,{className:d("w-4 h-4 fill-current text-gray-400","group-hover:text-purple-500 group-hover:text-opacity-80","group-focus-within:text-purple-500 group-focus-within:text-opacity-80")}))),!!o.length&&p.createElement("ul",{ref:f,className:"absolute z-10 w-96 max-w-[calc(100%-16px)] bg-white shadow-xl overflow-auto rounded-b-lg border-2 border-t-0 border-purple-100 divide-y-2 divide-purple-100"},o.map(((e,r)=>p.createElement(P,{key:e.id,album:e,isHighlighted:r===s,onClick:()=>{t(e),n({type:"reset"})}})))))}function P(e){var t=e,{album:r,isHighlighted:n}=t,a=c(t,["album","isHighlighted"]);return p.createElement("li",{key:r.id},p.createElement("button",l({className:d("group relative w-full flex items-center justify-between px-2 py-1.5 hover:bg-purple-100 overflow-hidden","focus:outline-none",n&&"bg-purple-100")},a),p.createElement("div",{className:"relative w-full flex items-center space-x-2 overflow-hidden"},p.createElement("img",{src:r.images[2].url,className:"w-10 h-10 rounded"}),p.createElement("div",{className:"flex flex-col items-start leading-5"},p.createElement("div",{title:r.name,className:"whitespace-nowrap"},r.name),p.createElement("div",{title:r.artists[0].name,className:"whitespace-nowrap text-gray-900 text-opacity-60"},r.artists[0].name)),p.createElement("div",{className:"absolute h-full w-4 right-0 bg-gradient-to-l from-white group-hover:from-purple-100"})),n&&p.createElement("div",{className:"absolute right-0 h-full flex items-center pointer-events-none"},p.createElement("div",{className:"w-10 h-full bg-gradient-to-l from-purple-100"}),p.createElement("div",{className:"h-full bg-purple-100 flex items-center px-4"},p.createElement(z,{className:"w-4 h-4 fill-current text-purple-600 text-opacity-60 flex-shrink-0"})))))}function B(e){return u.exports.createElement("svg",l({viewBox:"0 0 16 16"},e),u.exports.createElement("path",{d:"M11.536 12.95L8 9.414 4.465 12.95 3.05 11.536 6.586 8 3.05 4.465 4.465 3.05 8 6.586l3.536-3.536 1.414 1.415L9.414 8l3.536 3.536-1.414 1.414z"}))}function q({album:e,onCloseClick:t,className:r}){return p.createElement("div",{className:d("group overflow-hidden",r)},p.createElement("div",{className:"relative flex flex-col"},t&&p.createElement(T,{onClick:e=>{e.stopPropagation(),t()}}),p.createElement("img",{src:e.images[0].url,onDragStart:e=>e.preventDefault(),className:"self-center"})))}function T(e){var t=c(e,[]);return p.createElement("button",l({className:"invisible group-hover:visible absolute top-0 right-0 p-2 bg-black bg-opacity-30 rounded-bl-lg text-gray-200 hover:text-white focus:outline-none"},t),p.createElement(B,{className:"w-4 h-4 fill-current"}))}const U=f((e=>({ids:Array(9).fill(null).map(((e,t)=>t.toString())),entities:Object.fromEntries(Array(9).fill(null).map(((e,t)=>[t.toString(),null]))),add:t=>e((e=>{const r=e.ids.find((t=>null===e.entities[t]));return void 0===r?e:i(l({},e),{entities:i(l({},e.entities),{[r]:t})})})),sort:(t,r)=>e((e=>{const n=e.ids.findIndex((e=>e===t)),a=e.ids.findIndex((e=>e===r)),s=e.ids.slice();return s[n]=r,s[a]=t,i(l({},e),{ids:s})})),remove:t=>e((e=>i(l({},e),{entities:i(l({},e.entities),{[t]:null})})))})));function $({items:e,onDragEnd:t,children:r}){const[n,a]=u.exports.useState(null),s=g(h(x,{activationConstraint:{distance:15}}),h(v,{activationConstraint:{distance:15}}),h(C,{coordinateGetter:D})),o=U((e=>e.entities[n||""]));return p.createElement(b,{sensors:s,collisionDetection:w,onDragStart:e=>a(e.active.id),onDragEnd:e=>{t(e),a(null)},onDragCancel:()=>a(null)},p.createElement(y,{items:e,strategy:E},r),N.exports.createPortal(p.createElement(k,{adjustScale:!0,zIndex:2},o&&p.createElement(q,{album:o,className:"shadow-xl ring-4 ring-purple-400"})),document.body))}function _(e){var t=e,{id:r,dragClassNames:n,children:a}=t,s=c(t,["id","dragClassNames","children"]);const{attributes:o,listeners:u,setNodeRef:m,transform:f,transition:g,isDragging:h}=A({id:r,animateLayoutChanges:()=>!1}),v={transform:S.Transform.toString(f),transition:g||void 0};return p.createElement("li",i(l(l(i(l({},s),{ref:m,style:l({touchAction:"none"},v)}),o),u),{className:d(s.className,h&&n)}),a)}function J({exportRef:e}){return p.createElement("button",{onClick:async()=>{if(!e.current)return;!function(e,t){const r=document.createElement("a");r.href=e,r.setAttribute("download",t),r.click()}(await O(e.current,{canvasHeight:1920,canvasWidth:1920}),"chart.jpg")},style:{background:"repeating-linear-gradient(\n          -55deg,\n          #FCE7F3,\n          #FCE7F3 10px,\n          #FBCFE8 10px,\n          #FBCFE8 20px\n        )"},className:"px-2 py-1 rounded font-work text-purple-900 text-opacity-80 text-lg"},"Download")}function K(){const[e,t]=function(e,t){const[r,n]=u.exports.useState((()=>{try{const r=window.localStorage.getItem(e);if(!r)return t;try{return JSON.parse(r)}catch{return t}}catch(r){return console.error(r),t}}));return[r,t=>{try{const a=t instanceof Function?t(r):t;n(a),window.localStorage.setItem(e,JSON.stringify(a))}catch(a){console.log(a)}}]}("auth",{token:"",expiresAt:Date.now()});return u.exports.useEffect((()=>{e.token&&e.expiresAt>Date.now()||async function e(){const r=await L();t(r),setTimeout(e,r.expiresAt-Date.now())}()}),[e.expiresAt,e.token,t]),e}function V(){const e=K(),t=U((e=>e.ids)),r=U((e=>e.entities)),n=U((e=>e.add)),a=U((e=>e.sort)),s=U((e=>e.remove)),o=u.exports.useRef(null);return p.createElement("div",{className:"font-nunito flex flex-col space-y-10 items-center pt-10 text-gray-900"},p.createElement("h1",{className:"font-work text-5xl bg-gradient-to-r from-pink-400 via-purple-500 to-pink-400 bg-clip-text text-transparent animate-stripes motion-reduce:animate-none filter drop-shadow-lg"},"Music List"),p.createElement(M,{auth:e,onAlbumSelect:e=>n(e)}),p.createElement("div",null,p.createElement("div",{ref:o,className:"bg-white"},p.createElement($,{items:t,onDragEnd:({active:e,over:t})=>{t&&e.id!==t.id&&a(e.id,t.id)}},p.createElement("ul",{style:{lineHeight:0,width:"90vw",height:"90vw",maxWidth:576,maxHeight:576}},t.map((e=>{const t=r[e];return p.createElement(_,{key:e,id:e,className:"inline-flex w-1/3 h-1/3 overflow-hidden cursor-default focus:outline-none focus:ring-4 focus:relative ring-purple-300",dragClassNames:"opacity-30 focus:ring-0"},t?p.createElement(q,{album:t,onCloseClick:()=>s(e)}):p.createElement("div",{className:"flex flex-1 bg-gray-200 bg-opacity-90"}))})))))),p.createElement("div",{className:"pb-10"},p.createElement(J,{exportRef:o})))}j.render(p.createElement(p.StrictMode,null,p.createElement(V,null)),document.getElementById("root"));
