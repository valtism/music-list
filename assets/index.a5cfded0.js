var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,l=(t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,o=(e,t)=>{for(var r in t||(t={}))n.call(t,r)&&l(e,r,t[r]);if(a)for(var r of a(t))s.call(t,r)&&l(e,r,t[r]);return e},i=(e,a)=>t(e,r(a)),c=(e,t)=>{var r={};for(var l in e)n.call(e,l)&&t.indexOf(l)<0&&(r[l]=e[l]);if(null!=e&&a)for(var l of a(e))t.indexOf(l)<0&&s.call(e,l)&&(r[l]=e[l]);return r};import{r as u,l as m,R as d,c as p,u as f,a as h,T as v,M as b,D as g,b as y,S as w,d as x,e as E,s as N,K as k,f as D,C as O,g as S,h as A}from"./vendor.0acbaabb.js";async function C(){const e=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{Authorization:"Basic ZThkOWU0OTQ4YzI0NGRiNGEwMmE4OGI1ZDBjYzZkYjQ6ZDllZmZkNmYzYTZkNDVlODllNDQ3ZmVkNmMxMTNiNGQ="},body:new URLSearchParams({grant_type:"client_credentials"})}),{access_token:t,token_type:r,expires_in:a}=await e.json();return{token:`${r} ${t}`,expiresAt:Date.now()+1e3*(a-100)}}async function L(e,t){if(!t)return[];e.token||(e=await C());const r=await fetch(`https://api.spotify.com/v1/search?type=album&limit=5&q=${t}`,{headers:{Authorization:e.token}}),{albums:a}=await r.json();return a.items}const j={input:"",index:0,albums:[],searches:{}};function M(e,t){switch(t.type){case"setInput":return i(o({},e),{input:t.payload,index:0,albums:e.searches[t.payload]||e.albums});case"setAlbums":return i(o({},e),{albums:e.searches[e.input]?e.searches[e.input]:t.payload.albums,searches:i(o({},e.searches),{[t.payload.query]:t.payload.albums})});case"arrowUp":{const{index:t,albums:r}=e;return i(o({},e),{index:t<=0?r.length-1:t-1})}case"arrowDown":{const{index:t,albums:r}=e;return i(o({},e),{index:t>=r.length-1?0:t+1})}case"blur":return i(o({},e),{albums:[]});case"reset":return i(o({},e),{input:"",albums:[]});default:throw new Error}}function z(e){return u.exports.createElement("svg",o({viewBox:"0 0 16 16"},e),u.exports.createElement("path",{d:"M4.99 13v-3H15V3h-2v5H4.99V5L1 9l3.99 4z"}))}function R(e){return u.exports.createElement("svg",o({viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},e),u.exports.createElement("path",{fillRule:"evenodd",d:"M9.476 10.89a6 6 0 111.414-1.414l4.845 4.845-1.414 1.414-4.845-4.844zM9.818 6a3.818 3.818 0 11-7.636 0 3.818 3.818 0 017.636 0z"}))}function I({auth:e,onAlbumSelect:t}){const[r,a]=u.exports.useReducer(M,j),{input:n,index:s,albums:l,searches:o}=r,i=u.exports.useMemo((()=>m((async t=>{const r=await L(e,t);a({type:"setAlbums",payload:{albums:r,query:t}})}),300)),[e,a]),c=u.exports.useRef(null),f=function(e,...t){const r=u.exports.useRef(null);return u.exports.useEffect((()=>{const a=a=>{r.current&&![r,...t].some((e=>{var t;return null==(t=e.current)?void 0:t.contains(a.target)}))&&e(a)};return document.addEventListener("mousedown",a),document.addEventListener("mouseup",a),document.addEventListener("touchstart",a),document.addEventListener("touchend",a),()=>{document.removeEventListener("mousedown",a),document.removeEventListener("mouseup",a),document.removeEventListener("touchstart",a),document.removeEventListener("touchend",a)}}),[r,e,t]),r}((()=>a({type:"blur"})),c);return d.createElement("div",{className:"w-96",onKeyDown:e=>{switch(e.key){case"ArrowUp":return e.preventDefault(),a({type:"arrowUp"});case"ArrowDown":return e.preventDefault(),a({type:"arrowDown"});case"Enter":if(e.preventDefault(),!l[s])return;return t(l[s]),i.cancel(),a({type:"reset"});case"Escape":return e.preventDefault(),i.cancel(),a({type:"reset"})}}},d.createElement("div",{className:"relative group"},d.createElement("input",{ref:c,autoCorrect:"off",placeholder:"Search",value:n,onChange:e=>{const t=e.target.value;o[t]?i.cancel():i(t),a({type:"setInput",payload:t})},onFocus:async t=>{if(t.target.select(),n)if(o[n])a({type:"setAlbums",payload:{albums:o[n],query:n}});else{const t=await L(e,n);a({type:"setAlbums",payload:{albums:t,query:n}})}},className:p("w-full border-2 border-gray-100 bg-gray-100 rounded-lg px-4 py-2","hover:border-purple-100","focus:bg-white focus:border-purple-100 focus:outline-none",l.length&&"rounded-b-none bg-white border-purple-100 outline-none")}),d.createElement("div",{className:"absolute inset-y-0 right-0 flex items-center pr-4 pointer-events-none"},d.createElement(R,{className:p("w-4 h-4 fill-current text-gray-400","group-hover:text-purple-500 group-hover:text-opacity-80","group-focus-within:text-purple-500 group-focus-within:text-opacity-80")}))),!!l.length&&d.createElement("ul",{ref:f,className:"absolute z-10 w-96 bg-white shadow-xl overflow-auto rounded-b-lg border-2 border-t-0 border-purple-100 divide-y-2 divide-purple-100"},l.map(((e,r)=>d.createElement(P,{key:e.id,album:e,isHighlighted:r===s,onClick:()=>{t(e),a({type:"reset"})}})))))}function P(e){var t=e,{album:r,isHighlighted:a}=t,n=c(t,["album","isHighlighted"]);return d.createElement("li",{key:r.id},d.createElement("button",o({className:p("group relative w-full flex items-center justify-between px-2 py-1.5 hover:bg-purple-100 overflow-hidden","focus:outline-none",a&&"bg-purple-100")},n),d.createElement("div",{className:"relative w-full flex items-center space-x-2 overflow-hidden"},d.createElement("img",{src:r.images[2].url,className:"w-10 h-10 rounded"}),d.createElement("div",{className:"flex flex-col items-start leading-5"},d.createElement("div",{title:r.name,className:"whitespace-nowrap"},r.name),d.createElement("div",{title:r.artists[0].name,className:"whitespace-nowrap text-gray-900 text-opacity-60"},r.artists[0].name)),d.createElement("div",{className:"absolute h-full w-4 right-0 bg-gradient-to-l from-white group-hover:from-purple-100"})),a&&d.createElement("div",{className:"absolute right-0 h-full flex items-center pointer-events-none"},d.createElement("div",{className:"w-10 h-full bg-gradient-to-l from-purple-100"}),d.createElement("div",{className:"h-full bg-purple-100 flex items-center px-4"},d.createElement(z,{className:"w-4 h-4 fill-current text-purple-600 text-opacity-60 flex-shrink-0"})))))}function T(){const[e,t]=function(e,t){const[r,a]=u.exports.useState((()=>{try{const r=window.localStorage.getItem(e);if(!r)return t;try{return JSON.parse(r)}catch{return t}}catch(r){return console.error(r),t}}));return[r,t=>{try{const n=t instanceof Function?t(r):t;a(n),window.localStorage.setItem(e,JSON.stringify(n))}catch(n){console.log(n)}}]}("auth",{token:"",expiresAt:Date.now()});return u.exports.useEffect((()=>{e.token&&e.expiresAt>Date.now()||async function e(){const r=await C();t(r),setTimeout(e,r.expiresAt-Date.now())}()}),[e.expiresAt,e.token,t]),e}function Z(e){return u.exports.createElement("svg",o({viewBox:"0 0 16 16"},e),u.exports.createElement("path",{d:"M11.536 12.95L8 9.414 4.465 12.95 3.05 11.536 6.586 8 3.05 4.465 4.465 3.05 8 6.586l3.536-3.536 1.414 1.415L9.414 8l3.536 3.536-1.414 1.414z"}))}function B(e){var t=e,{album:r,onCloseClick:a}=t,n=c(t,["album","onCloseClick"]);return d.createElement("div",o({},n),d.createElement("div",{className:"group relative w-48 p-2 rounded overflow-hidden bg-white"},d.createElement("div",{className:"relative flex flex-col"},a&&d.createElement("button",{onClick:e=>{e.stopPropagation(),a()},className:"invisible group-hover:visible absolute top-0 right-0 p-2 bg-black bg-opacity-30 rounded-bl-lg text-gray-200 hover:text-white focus:outline-none"},d.createElement(Z,{className:"w-4 h-4 fill-current"})),d.createElement("img",{src:r.images[1].url,onDragStart:e=>e.preventDefault(),className:"rounded self-center mb-1"}),d.createElement("div",{className:"flex flex-col whitespace-nowrap"},d.createElement("div",{title:r.name,className:"relative overflow-hidden"},d.createElement("span",{className:"text-sm"},r.name),d.createElement("div",{className:"absolute right-0 top-0 h-full w-4 bg-gradient-to-l from-white via-white"})),d.createElement("div",{title:r.artists[0].name,className:"text-sm text-gray-600 leading-4 truncate"},r.artists[0].name)))))}function q({albums:e,onDragEnd:t,children:r}){const[a,n]=u.exports.useState(null),s=e.ids.map((t=>e.entities[t])),l=f(h(b,{activationConstraint:{distance:15}}),h(v,{activationConstraint:{distance:15}}),h(k,{coordinateGetter:N}));return d.createElement(g,{sensors:l,collisionDetection:y,onDragStart:e=>n(e.active.id),onDragEnd:e=>{n(null),t(e)}},d.createElement(w,{items:s,strategy:x},r),d.createElement(E,null,a?d.createElement(B,{album:e.entities[a],className:"shadow-xl"}):null))}function G({id:e,children:t}){const{attributes:r,listeners:a,setNodeRef:n,transform:s,transition:l,isDragging:i}=D({id:e}),c={transform:O.Transform.toString(s),transition:l||void 0};return d.createElement("div",o(o({ref:n,style:c,className:p("inline-block focus:outline-none cursor-default",i&&"invisible")},r),a),t)}const H={ids:[],entities:{}};function U(e,t){switch(t.type){case"add":return e.entities[t.payload.id]?e:{ids:e.ids.concat(t.payload.id),entities:i(o({},e.entities),{[t.payload.id]:t.payload})};case"sort":return i(o({},e),{ids:Y(e.ids,t.payload.from,t.payload.to)});case"delete":return i(o({},e),{ids:e.ids.filter((e=>e!==t.payload)),entities:S(e.entities,t.payload)});default:throw new Error}}function Y(e,t,r){const a=e.slice();return a.splice(r,0,...a.splice(t,1)),a}function _(){const e=T(),[t,r]=u.exports.useReducer(U,H);return d.createElement("div",{className:"font-nunito flex flex-col space-y-10 items-center pt-10 text-gray-900"},d.createElement("h1",{className:"font-work text-5xl bg-gradient-to-r from-purple-500 to-pink-400 bg-clip-text text-transparent"},"Music List"),d.createElement(I,{auth:e,onAlbumSelect:e=>r({type:"add",payload:e})}),d.createElement("div",null,d.createElement(q,{albums:t,onDragEnd:e=>{const{active:a,over:n}=e;if(!n)return;if(a.id===n.id)return;const s=t.ids.indexOf(a.id),l=t.ids.indexOf(n.id);r({type:"sort",payload:{id:a.id,from:s,to:l}})}},d.createElement("div",{className:"container mx-auto px-20"},t.ids.map((e=>t.entities[e])).map((e=>d.createElement(G,{key:e.id,id:e.id},d.createElement(B,{album:e,onCloseClick:()=>r({type:"delete",payload:e.id})}))))))))}A.render(d.createElement(d.StrictMode,null,d.createElement(_,null)),document.getElementById("root"));
