var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,o=(t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,l=(e,t)=>{for(var r in t||(t={}))n.call(t,r)&&o(e,r,t[r]);if(a)for(var r of a(t))s.call(t,r)&&o(e,r,t[r]);return e},i=(e,a)=>t(e,r(a)),c=(e,t)=>{var r={};for(var o in e)n.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&a)for(var o of a(e))t.indexOf(o)<0&&s.call(e,o)&&(r[o]=e[o]);return r};import{r as u,l as d,R as m,c as p,u as f,a as h,T as v,M as g,D as b,b as w,S as y,d as x,e as E,s as N,K as k,f as D,C as A,g as O,t as S,h as C}from"./vendor.4e2c279d.js";async function L(){const e=await fetch("https://1pd7ps5dmd.execute-api.ap-southeast-2.amazonaws.com/default/spotifyAuth"),{access_token:t,token_type:r,expires_in:a}=await e.json();return{token:`${r} ${t}`,expiresAt:Date.now()+1e3*(a-100)}}async function j(e,t){if(!t)return[];e.token||(e=await L());const r=await fetch(`https://api.spotify.com/v1/search?type=album&limit=5&q=${t}`,{headers:{Authorization:e.token}}),{albums:a}=await r.json();return a.items}const R={input:"",index:0,albums:[],searches:{}};function M(e,t){switch(t.type){case"setInput":return i(l({},e),{input:t.payload,index:0,albums:e.searches[t.payload]||e.albums});case"setAlbums":return i(l({},e),{albums:e.searches[e.input]?e.searches[e.input]:t.payload.albums,searches:i(l({},e.searches),{[t.payload.query]:t.payload.albums})});case"arrowUp":{const{index:t,albums:r}=e;return i(l({},e),{index:t<=0?r.length-1:t-1})}case"arrowDown":{const{index:t,albums:r}=e;return i(l({},e),{index:t>=r.length-1?0:t+1})}case"blur":return i(l({},e),{albums:[]});case"reset":return i(l({},e),{input:"",albums:[]});default:throw new Error}}function z(e){return u.exports.createElement("svg",l({viewBox:"0 0 16 16"},e),u.exports.createElement("path",{d:"M4.99 13v-3H15V3h-2v5H4.99V5L1 9l3.99 4z"}))}function I(e){return u.exports.createElement("svg",l({viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},e),u.exports.createElement("path",{fillRule:"evenodd",d:"M9.476 10.89a6 6 0 111.414-1.414l4.845 4.845-1.414 1.414-4.845-4.844zM9.818 6a3.818 3.818 0 11-7.636 0 3.818 3.818 0 017.636 0z"}))}function P({auth:e,onAlbumSelect:t}){const[r,a]=u.exports.useReducer(M,R),{input:n,index:s,albums:o,searches:l}=r,i=u.exports.useMemo((()=>d((async t=>{const r=await j(e,t);a({type:"setAlbums",payload:{albums:r,query:t}})}),300)),[e,a]),c=u.exports.useRef(null),f=function(e,...t){const r=u.exports.useRef(null);return u.exports.useEffect((()=>{const a=a=>{r.current&&![r,...t].some((e=>{var t;return null==(t=e.current)?void 0:t.contains(a.target)}))&&e(a)};return document.addEventListener("mousedown",a),document.addEventListener("mouseup",a),document.addEventListener("touchstart",a),document.addEventListener("touchend",a),()=>{document.removeEventListener("mousedown",a),document.removeEventListener("mouseup",a),document.removeEventListener("touchstart",a),document.removeEventListener("touchend",a)}}),[r,e,t]),r}((()=>a({type:"blur"})),c);return m.createElement("div",{className:"w-96",onKeyDown:e=>{switch(e.key){case"ArrowUp":return e.preventDefault(),a({type:"arrowUp"});case"ArrowDown":return e.preventDefault(),a({type:"arrowDown"});case"Enter":if(e.preventDefault(),!o[s])return;return t(o[s]),i.cancel(),a({type:"reset"});case"Escape":return e.preventDefault(),i.cancel(),a({type:"reset"})}}},m.createElement("div",{className:"relative group"},m.createElement("input",{ref:c,autoCorrect:"off",placeholder:"Search",value:n,onChange:e=>{const t=e.target.value;l[t]?i.cancel():i(t),a({type:"setInput",payload:t})},onFocus:async t=>{if(t.target.select(),n)if(l[n])a({type:"setAlbums",payload:{albums:l[n],query:n}});else{const t=await j(e,n);a({type:"setAlbums",payload:{albums:t,query:n}})}},className:p("w-full border-2 border-gray-100 bg-gray-100 rounded-lg px-4 py-2","hover:border-purple-100","focus:bg-white focus:border-purple-100 focus:outline-none",o.length&&"rounded-b-none bg-white border-purple-100 outline-none")}),m.createElement("div",{className:"absolute inset-y-0 right-0 flex items-center pr-4 pointer-events-none"},m.createElement(I,{className:p("w-4 h-4 fill-current text-gray-400","group-hover:text-purple-500 group-hover:text-opacity-80","group-focus-within:text-purple-500 group-focus-within:text-opacity-80")}))),!!o.length&&m.createElement("ul",{ref:f,className:"absolute z-10 w-96 bg-white shadow-xl overflow-auto rounded-b-lg border-2 border-t-0 border-purple-100 divide-y-2 divide-purple-100"},o.map(((e,r)=>m.createElement(q,{key:e.id,album:e,isHighlighted:r===s,onClick:()=>{t(e),a({type:"reset"})}})))))}function q(e){var t=e,{album:r,isHighlighted:a}=t,n=c(t,["album","isHighlighted"]);return m.createElement("li",{key:r.id},m.createElement("button",l({className:p("group relative w-full flex items-center justify-between px-2 py-1.5 hover:bg-purple-100 overflow-hidden","focus:outline-none",a&&"bg-purple-100")},n),m.createElement("div",{className:"relative w-full flex items-center space-x-2 overflow-hidden"},m.createElement("img",{src:r.images[2].url,className:"w-10 h-10 rounded"}),m.createElement("div",{className:"flex flex-col items-start leading-5"},m.createElement("div",{title:r.name,className:"whitespace-nowrap"},r.name),m.createElement("div",{title:r.artists[0].name,className:"whitespace-nowrap text-gray-900 text-opacity-60"},r.artists[0].name)),m.createElement("div",{className:"absolute h-full w-4 right-0 bg-gradient-to-l from-white group-hover:from-purple-100"})),a&&m.createElement("div",{className:"absolute right-0 h-full flex items-center pointer-events-none"},m.createElement("div",{className:"w-10 h-full bg-gradient-to-l from-purple-100"}),m.createElement("div",{className:"h-full bg-purple-100 flex items-center px-4"},m.createElement(z,{className:"w-4 h-4 fill-current text-purple-600 text-opacity-60 flex-shrink-0"})))))}function H(){const[e,t]=function(e,t){const[r,a]=u.exports.useState((()=>{try{const r=window.localStorage.getItem(e);if(!r)return t;try{return JSON.parse(r)}catch{return t}}catch(r){return console.error(r),t}}));return[r,t=>{try{const n=t instanceof Function?t(r):t;a(n),window.localStorage.setItem(e,JSON.stringify(n))}catch(n){console.log(n)}}]}("auth",{token:"",expiresAt:Date.now()});return u.exports.useEffect((()=>{e.token&&e.expiresAt>Date.now()||async function e(){const r=await L();t(r),setTimeout(e,r.expiresAt-Date.now())}()}),[e.expiresAt,e.token,t]),e}function B(e){return u.exports.createElement("svg",l({viewBox:"0 0 16 16"},e),u.exports.createElement("path",{d:"M11.536 12.95L8 9.414 4.465 12.95 3.05 11.536 6.586 8 3.05 4.465 4.465 3.05 8 6.586l3.536-3.536 1.414 1.415L9.414 8l3.536 3.536-1.414 1.414z"}))}function T(e){var t=e,{album:r,onCloseClick:a}=t,n=c(t,["album","onCloseClick"]);return m.createElement("div",l({},n),m.createElement("div",{className:"group relative w-48 p-2 rounded overflow-hidden bg-white"},m.createElement("div",{className:"relative flex flex-col"},a&&m.createElement("button",{onClick:e=>{e.stopPropagation(),a()},className:"invisible group-hover:visible absolute top-0 right-0 p-2 bg-black bg-opacity-30 rounded-bl-lg text-gray-200 hover:text-white focus:outline-none"},m.createElement(B,{className:"w-4 h-4 fill-current"})),m.createElement("img",{src:r.images[1].url,onDragStart:e=>e.preventDefault(),className:"rounded self-center mb-1"}),m.createElement("div",{className:"flex flex-col whitespace-nowrap"},m.createElement("div",{title:r.name,className:"relative overflow-hidden"},m.createElement("span",{className:"text-sm"},r.name),m.createElement("div",{className:"absolute right-0 top-0 h-full w-4 bg-gradient-to-l from-white via-white"})),m.createElement("div",{title:r.artists[0].name,className:"text-sm text-gray-600 leading-4 truncate"},r.artists[0].name)))))}function U({albums:e,onDragEnd:t,children:r}){const[a,n]=u.exports.useState(null),s=e.ids.map((t=>e.entities[t])),o=f(h(g,{activationConstraint:{distance:15}}),h(v,{activationConstraint:{distance:15}}),h(k,{coordinateGetter:N}));return m.createElement(b,{sensors:o,collisionDetection:w,onDragStart:e=>n(e.active.id),onDragEnd:e=>{n(null),t(e)}},m.createElement(y,{items:s,strategy:x},r),m.createElement(E,null,a?m.createElement(T,{album:e.entities[a],className:"shadow-xl"}):null))}function $({id:e,children:t}){const{attributes:r,listeners:a,setNodeRef:n,transform:s,transition:o,isDragging:i}=D({id:e}),c={transform:A.Transform.toString(s),transition:o||void 0};return m.createElement("div",l(l({ref:n,style:c,className:p("inline-block focus:outline-none cursor-default",i&&"invisible")},r),a),t)}const _={ids:[],entities:{}};function F(e,t){switch(t.type){case"add":return e.entities[t.payload.id]?e:{ids:e.ids.concat(t.payload.id),entities:i(l({},e.entities),{[t.payload.id]:t.payload})};case"sort":return i(l({},e),{ids:J(e.ids,t.payload.from,t.payload.to)});case"delete":return i(l({},e),{ids:e.ids.filter((e=>e!==t.payload)),entities:O(e.entities,t.payload)});default:throw new Error}}function J(e,t,r){const a=e.slice();return a.splice(r,0,...a.splice(t,1)),a}function K(){const e=H(),[t,r]=u.exports.useReducer(F,_),a=u.exports.useRef(null);return m.createElement("div",{className:"font-nunito flex flex-col space-y-10 items-center pt-10 text-gray-900"},m.createElement("h1",{className:"font-work text-5xl bg-gradient-to-r from-purple-500 to-pink-400 bg-clip-text text-transparent"},"Music List"),m.createElement(P,{auth:e,onAlbumSelect:e=>r({type:"add",payload:e})}),m.createElement("div",{ref:a,className:"bg-white"},m.createElement(U,{albums:t,onDragEnd:e=>{const{active:a,over:n}=e;if(!n)return;if(a.id===n.id)return;const s=t.ids.indexOf(a.id),o=t.ids.indexOf(n.id);r({type:"sort",payload:{id:a.id,from:s,to:o}})}},m.createElement("div",{className:"container mx-auto px-20"},t.ids.map((e=>t.entities[e])).map((e=>m.createElement($,{key:e.id,id:e.id},m.createElement(T,{album:e,onCloseClick:()=>r({type:"delete",payload:e.id})}))))))),!!t.ids.length&&m.createElement(V,{exportRef:a}))}function V({exportRef:e}){return m.createElement("button",{onClick:async()=>{if(!e.current)return;!function(e,t){const r=document.createElement("a");r.href=e,r.setAttribute("download",t),r.click()}(await S(e.current),"chart.jpg")}},"Download")}C.render(m.createElement(m.StrictMode,null,m.createElement(K,null)),document.getElementById("root"));
